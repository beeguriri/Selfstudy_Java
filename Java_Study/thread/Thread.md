## Thread

#### 1. Thread / Process

+ Thread
  + 하나의 프로그램 내에서 병행
  + 현재 실행하는 프로그램의 프로세스에서 사용하는 메모리와 자원 공유
+ Process
  + 여러개의 프로그램 실행
  + 프로세스 생성될 때마다 새로운 매모리, 자원 할당



#### 2. 목적

+ 여러 사용자 동시 요청하는 상황
  + 싱글스레드 환경 : 한 사용자의 처리 완료 후 다른 사용자의 요청 처리
+ 외부 데이터 처리
  + CPU의 유휴시간 줄어듦
+ 함께 실행되던 모든 스레드가 종료되어야 프로그램 종료



#### 3. 구현 및 실행

+ `Thread`	클래스 상속 
  +  `run()`메서드 구현 
  + `start()` 메서드로 실행
  + `setPriority(MAX/MIN/NORM_PRIORITY)`로 우선순위 지정
    + 우선순위가 높을 수록 다른 스레드보다 실행시간 더 많이 확보
    + 우선순위가 높은 스레드(MAX_PRIORITY)가 먼저 종료 됨
    + 우선순위 값 : 1 ~ 10 정수

```java
public class ThreadTest {
    public static void main(String[] args) { //main() 스레드 실행
        Food work1 = new Food();
        work1.start(); //스레드 실행
    }
}

class Food extends Thread{
    public void run() {
		//실행할 메서드 작성
    }
}
```



+ `Runnable` 인터페이스 상속 
  + `run()`메서드 구현
  + Thread객체 생성 후 `start()` 메서드로 실행



#### 4. 동기화(synchronized)

+ 하나의 자원을 여러 스레드가 동시에 접근하여 사용할 때
+ 발생할 수 있는 오류를 방지하기 위한 작업
+ 블록 동기화 : synchronized(객체명) {...}
  + 객체가 하나의 스레드에 의해 사용이 되고 있는 경우
  + 이 스레드의 작업이 완료될때 까지
  + 다른 스레드는 객체에 접근 할 수 없음
  + 0번 스레드 작업완료 후 1번 스레드 작업
+ 메서드 동기화: synchronize 메서드명() {...}
  + 해당 메서드가 한 스레드에 의해 사용 되고 있는 경우
  + 실행이 완료될 때 까지 다른 스레드는 실행할 수 없음
  + 스레드 실행순서에 관계없이 메서드가 호출



#### 5. 스레드 제어

+ 하나의 자원을 대상으로 소비와 생산 작업이 동시에 실행 되는 경우
+ `wait()` 소비하는 스레드는 자원이 있을때 까지 대기
+ `notify()` `notifyAll()` 생산하는 스레드는 자원 생산 후 알려줌
+ `join()` 한 스레드 작업이 완료 후 다음 스레드 작업
+ `sleep()` 지정된 시간동안 스레드를 대기상태로 전환
+ `interrupt()` 실행대기 상태에 있는 스레드들의 실행 중지
+ 스레드 상태값

|              | 상태값                                  | 상태                                                         |
| ------------ | --------------------------------------- | ------------------------------------------------------------ |
| 객체생성     | NEW                                     | Thread 객체 생성, start()메서드 호출 전                      |
| start() 호출 | RUNNABLE                                | start() 메서드 호출되어 실행 가능                            |
| 실행         | RUNNING                                 | JVM에 의해 선택되어 실행될 수 있음                           |
| 실행대기     | WAITING<br />BLOCKED<br />TIMED_WAITING | JVM에 의해 RUNNABLE 상태로 변경<br />다른 Thread에 의해 RUNNABLE 상태로 변경<br />일정시간이 지나면 RUNNABLE 상태로 변경 |
| 실행         | RUNNING                                 |                                                              |
| 실행완료     | TERMINATED                              | Thread 실행 종료                                             |



#### 6. 스레드 풀

+ `ExecutorService` 객체 생성해서 사용
+ 미리 스레드를 몇개 생성해놓고 재사용하는 방식
+ 로직과 스레드를 1:1 매핑하지않음
+ 스레드의 생성과 삭제 비용 절감